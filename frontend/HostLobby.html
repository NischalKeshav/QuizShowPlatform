<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Host Lobby</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="card">
    <div class="logo">Quiz Whiz</div>
    <h1>Players Lobby</h1>
    <p>Code: <span id="lobbyToken" style="font-weight:bold">â€”</span></p>

    <div style="margin:12px 0; text-align:left;">
      <strong>Players joined</strong>
      <ul id="playerList" style="margin-top:8px; padding-left:1.1rem;"></ul>
      <p id="noPlayers" style="color:var(--muted)">No players have joined yet.</p>
    </div>

    <p style="margin-top:18px;">
      <button id="hostStartBtn">Start Game</button>
    </p>
  </div>

   <script src="https://cdn.socket.io/4.8.3/socket.io.min.js"></script>
   <script>
     const socket = io('http://localhost:3000');
     let roomCode = null;
     let userId = null;

     function renderPlayers(players) {
       const list = document.getElementById('playerList');
       list.innerHTML = '';
       if (!players || players.length === 0) {
         document.getElementById('noPlayers').style.display = 'block';
         return;
       }
       document.getElementById('noPlayers').style.display = 'none';
       players.forEach((p) => {
         const li = document.createElement('li');
         li.textContent = p;
         list.appendChild(li);
       });
     }

     // Assume host enters name or something, but for simplicity, auto-create with default name
     const hostName = prompt('Enter your host name') || 'Host';
     socket.emit('create_room', { name: hostName });

     socket.on('room_created', (data) => {
       console.log('Received room_created:', data);
       roomCode = data.roomCode;
       userId = data.userId;
       document.getElementById('lobbyToken').textContent = roomCode;
       sessionStorage.setItem('hostToken', roomCode);
       sessionStorage.setItem('userId', userId);
       sessionStorage.setItem('roomCode', roomCode);
       // Get initial players (just host)
       socket.emit('get_players', { roomCode });
     });

     socket.on('players_list', (data) => {
       renderPlayers(data.players);
     });

     socket.on('player_joined', (data) => {
       renderPlayers(data.players);
     });

     document.getElementById('hostStartBtn').addEventListener('click', () => {
       if (!roomCode) return alert('No room created.');
       console.log('Emitting start_quiz for room:', roomCode);
       socket.emit('start_quiz', { roomCode });
       socket.on('quiz_started', () => {
         console.log('Received quiz_started, navigating to slideHost.html');
         window.location.href = 'slideHost.html';
       });
     });
   </script>
</body>
</html>
