

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Quiz Slides (Player)</title>
	<link rel="stylesheet" href="style.css" />
	<style>
		.slide-question { font-size:1.2rem; margin: 1rem 0; }
		.choices { display:flex; flex-direction:column; gap:0.6rem; margin-bottom:0.8rem; }
		.choice { padding:0.8rem; border-radius:0.6rem; background:#0f1025; cursor:pointer; border:1px solid rgba(255,255,255,0.03); }
		.choice.selected { outline:2px solid var(--primary); }
		.meta { display:flex; justify-content:space-between; align-items:center; gap:12px; }
		#timer { font-weight:700; }
		#reveal { margin-top:0.8rem; }
		#leaderboard { text-align:left; margin-top:0.8rem; }
		.small { font-size:0.9rem; color:var(--muted); }
	</style>
</head>
<body>
	<div class="card" style="max-width:760px;">
		<div class="logo">Quiz Whiz</div>
		<h1>Live Quiz (Player)</h1>

		<div class="meta">
			<div>Code: <span id="token">—</span></div>
			<div>Slide <span id="currentIdx">0</span>/<span id="totalSlides">0</span></div>
			<div>Time: <span id="timer">0</span>s</div>
		</div>

		<!-- Player name input removed; clicking a choice will prompt for name if needed -->

		<div id="slideArea" style="margin-top:10px">
			<div class="slide-question" id="question">No slide loaded.</div>
			<div class="choices" id="choices"></div>
			<div id="reveal"></div>
		</div>

		<div id="leaderboard"></div>

		<!-- Host controls removed from player view -->

		<hr style="margin:12px 0; opacity:0.06" />

		<!-- Simulation controls removed -->

	</div>

	<script src="https://cdn.socket.io/4.8.3/socket.io.min.js"></script>
	<script>
		window.addEventListener('DOMContentLoaded', () => {
			const socket = io('http://localhost:3000');
			const roomCode = sessionStorage.getItem('roomCode');
			const userId = sessionStorage.getItem('userId');

			let currentQuestionIndex = 0;
			let timerInterval = null;

			document.getElementById('token').textContent = roomCode || '—';
			document.getElementById('totalSlides').textContent = '—'; // Will update when quiz starts

			socket.on('new_question', (data) => {
				currentQuestionIndex = data.questionIndex;
				document.getElementById('currentIdx').textContent = currentQuestionIndex + 1;
				document.getElementById('totalSlides').textContent = '—'; // Assume unknown total
				document.getElementById('question').textContent = data.question.Question;
				const choicesEl = document.getElementById('choices');
				choicesEl.innerHTML = '';
				data.question.Choices.forEach((choice, idx) => {
					const btn = document.createElement('div');
					btn.className = 'choice';
					btn.textContent = choice;
					btn.addEventListener('click', () => {
						socket.emit('submit_answer', { roomCode, userId, answerIndex: idx });
						document.querySelectorAll('.choice').forEach(el => el.classList.remove('selected'));
						btn.classList.add('selected');
						document.getElementById('reveal').innerHTML = '<div class="small">Answer submitted.</div>';
					});
					choicesEl.appendChild(btn);
				});
				document.getElementById('reveal').innerHTML = '';
				startTimer(data.timeLimit);
			});

			socket.on('reveal_answers', (data) => {
				clearInterval(timerInterval);
				document.getElementById('timer').textContent = '0';
				let revealText = `<div>Correct answer: <strong>${data.correctAnswer}</strong></div>`;
				if (data.correctNames.length > 0) {
					revealText += `<div style="margin-top:6px">Correct: ${data.correctNames.join(', ')}</div>`;
				}
				document.getElementById('reveal').innerHTML = revealText;
			});

			socket.on('leaderboard_update', (data) => {
				const leaderboard = data.leaderboard;
				const el = document.getElementById('leaderboard');
				if (leaderboard.length === 0) {
					el.innerHTML = '<div class="small">No scores yet.</div>';
					return;
				}
				el.innerHTML = '<strong>Leaderboard</strong><ol>' + leaderboard.map(([name, score]) => `<li>${name} — ${score}</li>`).join('') + '</ol>';
			});

			function startTimer(sec) {
				let t = sec;
				document.getElementById('timer').textContent = t;
				timerInterval && clearInterval(timerInterval);
				timerInterval = setInterval(() => {
					t -= 1;
					document.getElementById('timer').textContent = t;
					if (t <= 0) {
						clearInterval(timerInterval);
						timerInterval = null;
					}
				}, 1000);
			}

			// Connect and join if not already
			if (roomCode && userId) {
				socket.emit('rejoin_room', { roomCode, userId }); // Assume we add this event if needed
			}
		});
	</script>
</body>
</html>

